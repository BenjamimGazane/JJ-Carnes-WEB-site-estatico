<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Recibo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style2.css">
</head>
<body>
  <div class="container">
    <h2 class="text-danger">Recibo - JJ Carnes</h2>
    <p>Data: <span id="dataAtual"></span></p>

    <table class="table table-bordered mt-4">
      <thead class="table-danger">
        <tr>
          <th>Produto</th>
          <th>Pre√ßo</th>
          <th>Quantidade</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody id="tabelaItens"></tbody>
    </table>

    <h5 class="text-end" style="margin-bottom: 5rem;">Total: <span id="totalCompra"></span> Mts</h5>
    <h5 class="text-start" style="color: red;">Nb:Baixe o recibo ou faca o screenshot da pagina e envie ao fornecedor via whatsapp</h5>
    <button onclick="gerarReciboPDF()" class="btn btn-success mb-4">
  <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="white" class="me-1" viewBox="0 0 16 16">
    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.6A1 1 0 0 0 2.5 14h11a1 1 0 0 0 1-1v-2.6a.5.5 0 0 1 1 0v2.6a2 2 0 0 1-2 2H2.5a2 2 0 0 1-2-2v-2.6a.5.5 0 0 1 .5-.5z"/>
    <path d="M7.646 10.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 9.293V1.5a.5.5 0 0 0-1 0v7.793L5.354 7.146a.5.5 0 1 0-.708.708l3 3z"/>
  </svg>
  Baixar Recibo (PDF)
</button>
  </div>
  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script>
    const dados = JSON.parse(localStorage.getItem("dadosCarrinho")) || [];

    // Agrupar por nome
    const agrupados = {};
    dados.forEach(item => {
      if (agrupados[item.nome]) {
        agrupados[item.nome].quantidade++;
      } else {
        agrupados[item.nome] = { ...item, quantidade: 1 };
      }
    });

    // Popular tabela
    const corpo = document.getElementById("tabelaItens");
    let total = 0;

    Object.values(agrupados).forEach(item => {
      const preco = parseInt(item.preco.replace(/\D/g, ""));
      const subtotal = preco * item.quantidade;
      total += subtotal;

      corpo.innerHTML += `
        <tr>
          <td>${item.nome}</td>
          <td>${item.preco}</td>
          <td>${item.quantidade}</td>
          <td>${subtotal} Mts</td>
        </tr>
      `;
    });

    // Exibir total
    document.getElementById("totalCompra").textContent = total;

    // Exibir data
    document.getElementById("dataAtual").textContent = new Date().toLocaleDateString();
  </script>
</body>
</html>